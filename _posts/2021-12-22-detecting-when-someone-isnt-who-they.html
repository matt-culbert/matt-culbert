---
layout: post
title: Detecting When Someone Isnt Who They Say They Are
date: '2021-12-22T16:57:00.005-08:00'
author: Matt C
tags: 
modified_time: '2021-12-22T17:15:28.119-08:00'
thumbnail: https://blogger.googleusercontent.com/img/a/AVvXsEjIS3M2UL-gke1leGl7ixZ65mWDQo0_Fktzb1fcmwGuLDoOR6rwjcWcZ1S4B2ODz6Z-UDJX8HIhRj0XMRyWrwXxfIM-JKiRkBahEZqHTILMq-bUY5DVZwEBtq4BcA9KMo9SB1raUOp7OOgxizpMGI3E39Yc92EAGeI1mTRYhGiFLEI86r183wvJ8vKO2Q=s72-w456-c-h302
blogger_id: tag:blogger.com,1999:blog-8951407132095927802.post-1148494780113143744
blogger_orig_url: https://cr.culbertreport.com/2021/12/detecting-when-someone-isnt-who-they.html
---

<h2 style="text-align: left;">Using PowerShell To Find Fraudulent DLLs</h2><p>We've talked a lot on here about offensive stuff as of late, so let's shift gears and think about some methods for detecting what we've done. In the image below we have a real and a fake DLL. Looking at the file details it's pretty easy to spot which one is the original.<br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEjIS3M2UL-gke1leGl7ixZ65mWDQo0_Fktzb1fcmwGuLDoOR6rwjcWcZ1S4B2ODz6Z-UDJX8HIhRj0XMRyWrwXxfIM-JKiRkBahEZqHTILMq-bUY5DVZwEBtq4BcA9KMo9SB1raUOp7OOgxizpMGI3E39Yc92EAGeI1mTRYhGiFLEI86r183wvJ8vKO2Q=s767" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="509" data-original-width="767" height="302" src="https://blogger.googleusercontent.com/img/a/AVvXsEjIS3M2UL-gke1leGl7ixZ65mWDQo0_Fktzb1fcmwGuLDoOR6rwjcWcZ1S4B2ODz6Z-UDJX8HIhRj0XMRyWrwXxfIM-JKiRkBahEZqHTILMq-bUY5DVZwEBtq4BcA9KMo9SB1raUOp7OOgxizpMGI3E39Yc92EAGeI1mTRYhGiFLEI86r183wvJ8vKO2Q=w456-h302" width="456" /></a></div><br />In the supposed "libcurl.dll" we can see a lot of file details are missing. This is a good jumping off point to start working on how to detect and identify files similar to these. One quick point, I wanted to not rely on the Digital Signatures file portion primarily because legitimate files can often come without this.<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgp8oGqJCEBOwaMfP3SDOUPirVy-f3hrbMz4ECNMv73r3lM1Q1dih2KqLZS5rOKqMNjCt3BVDvbf-y26MCe5RtM1Xa2FFfqmduiEXFyQTrvKD9icby_Uamb3RbxfP5WpAaokrsvz8xRTX_z5pCKf0uFpzPeAPftDUTO7rU9sU0lRiJhlv_rQTs3C9kD7Q=s973" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="538" data-original-width="973" height="271" src="https://blogger.googleusercontent.com/img/a/AVvXsEgp8oGqJCEBOwaMfP3SDOUPirVy-f3hrbMz4ECNMv73r3lM1Q1dih2KqLZS5rOKqMNjCt3BVDvbf-y26MCe5RtM1Xa2FFfqmduiEXFyQTrvKD9icby_Uamb3RbxfP5WpAaokrsvz8xRTX_z5pCKf0uFpzPeAPftDUTO7rU9sU0lRiJhlv_rQTs3C9kD7Q=w489-h271" width="489" /></a></div><br /> At first I wanted to use Yara but Yaras strong point is detecting when strings DO exist, less so when they don't. So I moved onto Powershell.<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEi3xAB9ZBy4zMovdCXOLLatrsGlFhxmxdYKk0k1c0qi2gOFZljziDgxeXBcoS36-UcFPGmzsrWJrXOa832XyZDxin2U90-28uIaqJm-y31RzxufST694QmnFNMIktSkyCbQYWUMlIIc7uNB0VYafwNA13CMOKwwBFPY_PEPIPcD_sl65cYuxLFaMHFhbw=s1201" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="690" data-original-width="1201" height="278" src="https://blogger.googleusercontent.com/img/a/AVvXsEi3xAB9ZBy4zMovdCXOLLatrsGlFhxmxdYKk0k1c0qi2gOFZljziDgxeXBcoS36-UcFPGmzsrWJrXOa832XyZDxin2U90-28uIaqJm-y31RzxufST694QmnFNMIktSkyCbQYWUMlIIc7uNB0VYafwNA13CMOKwwBFPY_PEPIPcD_sl65cYuxLFaMHFhbw=w484-h278" width="484" /></a></div>And as you can see above, it's a lot easier and gives us what we want in a nicely formatted list. So now what we need out of this is to recursively run on a directory which we can add with <span style="font-family: courier;">$Env:USERPROFILE\Desktop </span>in place of the file name, and we need to filter on the VersionInfo parameters to see if they're empty. Also not super difficult with the -property flag.<p></p><p><span style="font-family: times;"><span style="font-family: courier;"><span style="font-family: times;"></span></span></span></p><div class="separator" style="clear: both; text-align: center;"><span style="font-family: courier;"><span style="font-family: times;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEgJhyO03atZr1-q_9aEBfEshfyehlrIfmq47ZzshUFBrUKZ0MVz1xECHk7ojLElXx3sjy3xtI-lejw9h4Vik4sH01XC1WBqxHE2L_s_w6BCXdDeCQh4Se33809Wn5k7ut-WQsDE9XGMntwVABNEoxG-7s6tnW7awadLbvEOEPmFE-qrQSoG4ZvRiagirw=s1480" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="276" data-original-width="1480" height="114" src="https://blogger.googleusercontent.com/img/a/AVvXsEgJhyO03atZr1-q_9aEBfEshfyehlrIfmq47ZzshUFBrUKZ0MVz1xECHk7ojLElXx3sjy3xtI-lejw9h4Vik4sH01XC1WBqxHE2L_s_w6BCXdDeCQh4Se33809Wn5k7ut-WQsDE9XGMntwVABNEoxG-7s6tnW7awadLbvEOEPmFE-qrQSoG4ZvRiagirw=w608-h114" width="608" /></a></span></span><br /></div><p><span style="font-family: times;"><span style="font-family: courier;"><span style="font-family: times;"><span style="font-size: large;">Hhhmmm, now which one is the real libcurl... </span><br /></span></span></span></p><div class="separator" style="clear: both; text-align: center;"><span style="font-family: courier;"><a href="https://blogger.googleusercontent.com/img/a/AVvXsEiDKBrExsd9n4TybPluTEflnvUGv-HxRlQ9gUc6LivJAP6h342TJy9fS8XmBn9aqe1z-dF9j4E0QwucUKk7u1uOiCUt2DyH4VdwraF5PYLHJszZ04q87F-g4VtokShOW_-wwgwJQyP7E9cYyCBJgmZFZ_-hX97f02Lzvp0o4XG850hkLaDJ6rCfaa846g=s1642" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="514" data-original-width="1642" height="186" src="https://blogger.googleusercontent.com/img/a/AVvXsEiDKBrExsd9n4TybPluTEflnvUGv-HxRlQ9gUc6LivJAP6h342TJy9fS8XmBn9aqe1z-dF9j4E0QwucUKk7u1uOiCUt2DyH4VdwraF5PYLHJszZ04q87F-g4VtokShOW_-wwgwJQyP7E9cYyCBJgmZFZ_-hX97f02Lzvp0o4XG850hkLaDJ6rCfaa846g=w595-h186" width="595" /></a></span></div><span style="font-family: courier;"><br /></span>And there we go, we can get some quick file information from a directory and check for programs missing key publisher information. This won't catch sophisticated attackers, but you may find some interesting files worth investigating further this way. <br /><p></p><p></p>