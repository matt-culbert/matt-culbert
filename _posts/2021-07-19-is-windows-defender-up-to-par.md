---
layout: post
title: Is Windows Defender Up To Par?
date: '2021-07-19T19:53:00.005-07:00'
author: Matt C
tags: 
modified_time: '2021-07-19T20:08:05.241-07:00'
thumbnail: https://1.bp.blogspot.com/-0EtCUx-6c50/YPYR0hrclII/AAAAAAAAHmo/2RSxg8FGPPUvo1XAhSPM13UiX54DgarygCLcBGAsYHQ/s72-w400-c-h232/renamed_exe_blocked.png
blogger_id: tag:blogger.com,1999:blog-8951407132095927802.post-1067225382171591752
blogger_orig_url: https://cr.culbertreport.com/2021/07/is-windows-defender-up-to-par.html
---

<h1 style="text-align: left;">How Effective Is Defender?</h1><h3 style="text-align: left;">Short answer: Effective Enough<br /></h3><h3 style="text-align: left;"><span><a name='more'></a></span></h3><h3 style="text-align: left;">Long answer: Read on</h3><h2 style="text-align: left;">Testing Methodology:</h2><p style="text-align: left;"><span>&nbsp;&nbsp; &nbsp;</span>I have a bunch of random malware samples on my PC ranging from Mimikatz to ransomware so we have a lot to work with! I'm going to be testing initially with Sophos vs Defender and our first test is to download Windows 10, boot up a VM, and see if we can download the renamed Mimikatz exe. As seen below, this was immediately flagged.</p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-0EtCUx-6c50/YPYR0hrclII/AAAAAAAAHmo/2RSxg8FGPPUvo1XAhSPM13UiX54DgarygCLcBGAsYHQ/s1019/renamed_exe_blocked.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="588" data-original-width="1019" height="232" src="https://1.bp.blogspot.com/-0EtCUx-6c50/YPYR0hrclII/AAAAAAAAHmo/2RSxg8FGPPUvo1XAhSPM13UiX54DgarygCLcBGAsYHQ/w400-h232/renamed_exe_blocked.png" title="As illustrated, Defender is still preventing us from downloading this." width="400" /></a></div><p></p> <span>&nbsp;&nbsp; &nbsp;</span>Not only was the exe flagged, so was the zip file. So let's try  renaming everything in the source, removing Mimikatz, Powerkatz, all the  names from the authors, everything.<p style="text-align: left;"></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-ViRByFqX9rc/YPYiDZa3oTI/AAAAAAAAHm0/Npn1-BM51X4XjSMUNobyFR-kDCR6h3nqgCLcBGAsYHQ/s1019/powerkatz_blocked.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="733" data-original-width="1019" height="288" src="https://1.bp.blogspot.com/-ViRByFqX9rc/YPYiDZa3oTI/AAAAAAAAHm0/Npn1-BM51X4XjSMUNobyFR-kDCR6h3nqgCLcBGAsYHQ/w400-h288/powerkatz_blocked.png" title="As illustrated, Defender is still preventing us from downloading this." width="400" /></a></div><span>&nbsp;&nbsp; &nbsp;</span>Now these are well known files with signatures everywhere you look to detect them. How does Defender do with something completely new? For this, I wrote a quick ransomware emulator. It just encrypts a random file I made on execution. <p></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-N4xU--t_Q2s/YPYmH5TTw5I/AAAAAAAAHm8/IxOGkt2tPlE5L6WaRlwzZ2UUjpQKmJnUwCLcBGAsYHQ/s416/ransomware.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="343" data-original-width="416" height="416" src="https://1.bp.blogspot.com/-N4xU--t_Q2s/YPYmH5TTw5I/AAAAAAAAHm8/IxOGkt2tPlE5L6WaRlwzZ2UUjpQKmJnUwCLcBGAsYHQ/w504-h416/ransomware.png" width="504" /></a></div><br /><span>&nbsp;&nbsp; &nbsp;</span>Here is where Defender and Sophos started to differ. This sample, when converted to an exe, was caught by 16/68 products... That's not great. Among those that caught this were Defender, FireEye, and BitDefender. And for some reason McAfee. This was unexpected. I had high expectations that even common AV would be able to identify an executable encrypting arbitrary files. But Sophos and a number of others fell flat here.<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-LFIpAVw10Ns/YPYmw4Gr1FI/AAAAAAAAHnE/orPCVhb7GXwUw8-fVcJ56loMYrGUv024wCLcBGAsYHQ/s1309/catch_rate.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1230" data-original-width="1309" height="436" src="https://1.bp.blogspot.com/-LFIpAVw10Ns/YPYmw4Gr1FI/AAAAAAAAHnE/orPCVhb7GXwUw8-fVcJ56loMYrGUv024wCLcBGAsYHQ/w464-h436/catch_rate.png" width="464" /></a></div><span>&nbsp;&nbsp; &nbsp;</span>I thought that maybe this was only doing some sort of static code analysis only and that run time protection on the VM would be able to block this, but no. I was able to encrypt the random txt file. At this point I wanted to make the simulation a little more real in the hopes that other AV's might catch this new behavior more accurately. I changed the path from that random txt name to encrypting all txt files in the folder. This still wasn't caught... This isn't entirely true though. Each time this was run, SmartScreen kicked up an error since the code was missing a cert, so point to Defender there. <div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-dhhFfzHekD4/YPYu1oYWzoI/AAAAAAAAHnM/epNmO_IboBQz5bwkNLgIMnYwHjoPLwluwCLcBGAsYHQ/s449/ransomwareImproved.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="381" data-original-width="449" height="465" src="https://1.bp.blogspot.com/-dhhFfzHekD4/YPYu1oYWzoI/AAAAAAAAHnM/epNmO_IboBQz5bwkNLgIMnYwHjoPLwluwCLcBGAsYHQ/w547-h465/ransomwareImproved.png" width="547" /></a></div><p><br /><span>&nbsp;&nbsp;&nbsp; </span>The last piece I want to test is phishing detection. For this, I pulled a random submission any.run that was flagged with phishing. I tested Defender first and in Edge the site was detected! But, in Brave, the site was not flagged as such. It would be nice if this functionality was extended to other browsers but this is a pretty big lift. On the other side, Sophos didn't detect this at all and let me proceed normally.<br /></p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-WrxHqIYnbtw/YPY0dzCCcMI/AAAAAAAAHnc/kukhR7ypGisB9KNwzGbo8x_DdZPfSkUCACLcBGAsYHQ/s1022/defenderBlockedPhishing.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="679" data-original-width="1022" height="435" src="https://1.bp.blogspot.com/-WrxHqIYnbtw/YPY0dzCCcMI/AAAAAAAAHnc/kukhR7ypGisB9KNwzGbo8x_DdZPfSkUCACLcBGAsYHQ/w654-h435/defenderBlockedPhishing.png" width="654" /></a></div><br /><h3 style="text-align: left;">Conclusions</h3><p style="text-align: left;"><span>&nbsp;&nbsp;&nbsp; </span>In all of this, Defender has scored pretty high marks from me and has evidently improved leaps and bounds from where it was even a few years ago. Are you fine running this? Most likely. It picks up on the simple traits in my exe and accurately flags it as dangerous. I'm going to work to make my test set more obfuscated so that when I revisit this, I can test it more thoroughly. One area that it missed the mark on is legacy OS support. If you're not receiving Windows updates anymore, Defender won't be of use. Of note as well, in Gartners Magic Quadrant, while Defender scored well overall, it missed a few marks if used as an enterprise solution due to cost and capabilities. I'm going to quote them for this:<span><span class="unbalanced-text">&nbsp;</span></span></p><p style="text-align: center;"><i><span><span class="unbalanced-text">There is a large gulf in capability and cost between SKUs providing </span><span class="unbalanced-text">MDE</span><span class="unbalanced-text"> and those that do not, and some organizations are consequently unable  to justify the cost premium of Microsoft Defender for Endpoint.  Licensing Microsoft Defender individually outside of security bundles is  also not cost-effective for these customers. This led to a lower score  than the leading vendors in this Magic Quadrant for Sales  Execution/Pricing for 2021.</span></span></i></p><p style="text-align: center;"><i><span><span class="unbalanced-text">&nbsp; <br /></span></span></i></p><p></p>